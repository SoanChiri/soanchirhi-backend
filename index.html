<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Soan Chiri School of Language & Culture</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/header.css">
  <link rel="stylesheet" href="styles/forms.css">
  <style>
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      position: relative;
    }
    .hidden {
      display: none;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <a href="index.html">
        <img src="images/logo.jpg" alt="Soan Chiri School Logo" class="logo-img">
      </a>
      <div class="header-text">
        <h1>Soan Chiri School of Language & Culture</h1>
        <p class="motto">"ਸੋਨ ਚਿੜੀ ਉੱਡੇ ਅੰਬਰੀਂ ਲਾ ਅੱਖਰਾਂ ਦੇ ਖੰਭ"</p>
      </div>
      <div class="login-buttons">
        <button id="studentLogin" class="login-btn">Student Login</button>
        <button id="teacherLogin" class="login-btn">Teacher Login</button>
        <button id="adminLogin" class="login-btn admin-btn">Admin Login</button>
      </div>
    </div>
    <div class="social-media">
      <a href="https://www.facebook.com/profile.php?id=100083109408159&mibextid=LQQJ4d" target="_blank">Facebook</a>
      <a href="https://www.instagram.com/soanchirhi?igsh=aHB5bjlkampnbmU=" target="_blank">Instagram</a>
      <a href="https://www.tiktok.com/@soanchirhischooladelaide?_t=8pn5ckxigSK&_r=1" target="_blank">TikTok</a>
      <a href="https://youtube.com/@soanchirhiadelaide7546?si=uLn8Zj02DSNZVaVK" target="_blank">YouTube</a>
    </div>
  </header>

  <nav class="nav-bar">
    <!-- ... navigation links ... -->
  </nav>

  <!-- Login Modal -->
  <div id="loginModal" class="modal hidden">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h2>Student Login</h2>
      <form id="studentLoginForm">
        <input type="email" id="studentEmail" placeholder="Enter your email" required />
        <input type="password" id="studentPassword" placeholder="Enter your password" required />
        <button type="submit">Login</button>
        <p id="studentLoginMessage"></p>
      </form>
    </div>
  </div>

  <script>
    // Show login modal
    document.getElementById("studentLogin").addEventListener("click", function () {
      document.getElementById("loginModal").classList.remove("hidden");
    });

    // Close modal
    document.getElementById("closeModal").addEventListener("click", function () {
      document.getElementById("loginModal").classList.add("hidden");
    });

    // Teacher login button redirect
    document.getElementById("teacherLogin").addEventListener("click", function () {
      window.location.href = "teacher_login.html";
    });

    // Admin login button redirect
    document.getElementById("adminLogin").addEventListener("click", function () {
      window.location.href = "admin_login.html";
    });

    // Student login form submit
    document.getElementById("studentLoginForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const email = document.getElementById("studentEmail").value;
      const password = document.getElementById("studentPassword").value;

      const response = await fetch("https://soanchirhi-backend.onrender.com/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();
      const message = document.getElementById("studentLoginMessage");

      if (data.success && data.role === "student") {
        message.textContent = "Login successful! Redirecting...";
        message.style.color = "green";
        setTimeout(() => {
          if (data.firstLogin) {
            localStorage.setItem('userEmail', email);
            window.location.href = "change_password.html";
          } else {
            window.location.href = "student_resources.html";
          }
        }, 1000);
      } else {
        message.textContent = data.message || "Login failed.";
        message.style.color = "red";
      }
    });

    // Fetch and update the admission link dynamically
    fetch('https://soanchirhi-backend.onrender.com/admission-link')
      .then(response => response.json())
      .then(data => {
        const admissionButton = document.getElementById("admissionLink");
        if (admissionButton) {
          admissionButton.href = data.admissionLink;
        }
      })
      .catch(err => {
        console.error("Error loading admission link:", err);
      });
  </script>
</body>
</html>
